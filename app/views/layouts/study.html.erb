<!DOCTYPE html>
<html>
<head>
  <title>MCP STUDY</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%= yield :head %>

  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/assets/img/char_albbano.webp">
  <link rel="apple-touch-icon" href="/assets/img/char_albbano.webp">
  <style>
      @page {
          size: A4;
          margin: 2cm;
      }

      body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
          line-height: 1.6;
          color: #333;
          max-width: 1280px;
          margin: 0 auto;
          padding: 20px;
          background: #fff;
      }

      .container {
          background: white;
          border-radius: 8px;
          padding: 40px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }

      .header {
          text-align: center;
          border-bottom: 3px solid #f39c12;
          padding-bottom: 20px;
          margin-bottom: 30px;
      }

      /* 헤더 스타일 */
      .top {
          height: 50px;
          width: 100%;
          background-color: #333;
          color: #f2f2f2;
          padding: 10px 0;
          text-align: center;
          font-weight: 300;
      }

      .top h1 {
          font-size: 2.8em;
          margin: 0;
          font-weight: 500;
      }

      .top h2 {
          display: block;
          font-size: 1.5em;
          line-height: 15px;
          margin-block-start: 0.83em;
          margin-block-end: 0.83em;
          margin-inline-start: 0px;
          margin-inline-end: 0px;
          font-weight: bold;
          unicode-bidi: isolate;
          border: none;
          color: white;
      }

      .top p {
          font-size: 1em;
          margin: 5px 0 0;
          color: #bbb;
      }

      /* 네비게이션 */
      nav {
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          background-color: #222;
          padding: 15px 0;
          width: 100%;
          margin: 0;
      }

      nav a {
          height: 24px;
          color: #ccc;
          text-decoration: none;
          margin: 0 20px;
          font-weight: 400;
          font-size: 1.1em;
      }

      nav a:hover {
          color: #4a90e2;
      }

      h1 {
          color: #2c3e50;
          font-size: 2.5em;
          margin: 0;
      }

      .subtitle {
          color: #7f8c8d;
          font-size: 1.2em;
          margin-top: 10px;
      }

      h2 {
          color: #e67e22;
          border-left: 4px solid #f39c12;
          padding-left: 15px;
          margin-top: 40px;
      }

      h3 {
          color: #3498db;
          margin-top: 30px;
      }

      .step {
          background: #ecf0f1;
          border-radius: 8px;
          padding: 20px;
          margin: 20px 0;
          border-left: 4px solid #3498db;
      }

      .code-block {
          background: #2c3e50;
          color: #ecf0f1;
          padding: 15px;
          border-radius: 6px;
          overflow-x: auto;
          font-family: 'Consolas', 'Monaco', monospace;
          margin: 15px 0;
          white-space: pre-wrap;
      }

      .warning {
          background: #fff3cd;
          border: 1px solid #ffeaa7;
          border-radius: 6px;
          padding: 15px;
          margin: 15px 0;
      }

      .tip {
          background: #d1ecf1;
          border: 1px solid #bee5eb;
          border-radius: 6px;
          padding: 15px;
          margin: 15px 0;
      }

      .screenshot-placeholder {
          background: #f8f9fa;
          border: 2px dashed #dee2e6;
          border-radius: 8px;
          padding: 40px;
          text-align: center;
          color: #6c757d;
          margin: 20px 0;
      }

      .config-example {
          background: #f8f9fa;
          border: 1px solid #e9ecef;
          border-radius: 6px;
          padding: 15px;
          margin: 15px 0;
      }

      .definition-box {
          background: #e8f4f8;
          border: 1px solid #bee5eb;
          border-radius: 5px;
          padding: 20px;
          margin: 20px 0;
      }

      .definition-box strong {
          color: #155724;
      }

      .comparison-box {
          background: #fff3cd;
          border: 1px solid #ffeaa7;
          border-radius: 5px;
          padding: 20px;
          margin: 20px 0;
      }

      .component-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 15px;
          margin: 20px 0;
      }

      .component-item {
          background: #f8f9fa;
          border: 1px solid #dee2e6;
          border-radius: 5px;
          padding: 15px;
          text-align: center;
      }

      .component-item h4 {
          color: #007bff;
          margin-bottom: 10px;
      }

      .advantage-box {
          background: #d4edda;
          border: 1px solid #c3e6cb;
          border-left: 4px solid #28a745;
          border-radius: 5px;
          padding: 20px;
          margin: 20px 0;
      }

      .advantage-box h3 {
          color: #155724;
          margin-top: 0;
      }

      .flow-diagram {
          text-align: center;
          margin: 25px 0;
          padding: 20px;
          background: #f8f9fa;
          border-radius: 5px;
      }

      .flow-step {
          display: inline-block;
          background: #007bff;
          color: white;
          padding: 8px 16px;
          margin: 5px;
          border-radius: 20px;
          font-size: 0.9em;
      }

      .arrow {
          color: #6c757d;
          font-size: 1.2em;
          margin: 0 5px;
      }

      .highlight {
          background: #fff3cd;
          border: 1px solid #ffeaa7;
          padding: 15px;
          border-radius: 5px;
          margin: 15px 0;
      }

      .example-box {
          background: #e2e3e5;
          border: 1px solid #d6d8db;
          border-radius: 5px;
          padding: 20px;
          margin: 20px 0;
          font-family: 'Courier New', monospace;
          font-size: 0.9em;
      }

      table {
          width: 100%;
          border-collapse: collapse;
          margin: 20px 0;
      }

      th, td {
          border: 1px solid #ddd;
          padding: 12px;
          text-align: left;
      }

      th {
          background: #f8f9fa;
          font-weight: bold;
      }

      .toc {
          background: #f8f9fa;
          border-radius: 8px;
          padding: 20px;
          margin: 20px 0;
      }

      .toc ul {
          list-style-type: none;
          padding-left: 0;
      }

      .toc li {
          margin: 8px 0;
          padding-left: 20px;
      }

      .toc a {
          text-decoration: none;
          color: #3498db;
      }

      .footer {
          text-align: center;
          margin-top: 50px;
          padding-top: 20px;
          border-top: 1px solid #eee;
          color: #7f8c8d;
      }

      @media (max-width: 768px) {
          body {
              padding: 10px;
          }

          .container {
              padding: 20px;
          }

          .component-grid {
              grid-template-columns: 1fr;
          }

          .flow-step {
              display: block;
              margin: 10px auto;
          }

          .arrow {
              display: block;
              text-align: center;
          }
      }
  </style>
</head>

<body>
<%= render 'layouts/study_menu' %>

<div class="container">
  <%= yield %>
</div>

<%#= render 'layouts/footer' %>

</body>

<script>
	// PDF 출력을 위한 스타일 조정
	window.addEventListener('beforeprint', function() {
		document.body.style.fontSize = '12px';
	});

	window.addEventListener('afterprint', function() {
		document.body.style.fontSize = '';
	});
</script>

<!-- HTML head에 Prettier 라이브러리 추가 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/2.8.8/standalone.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/2.8.8/parser-babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/2.8.8/parser-html.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/2.8.8/parser-css.min.js"></script>

<script>
	function beautifyCodeBlocks() {
		document.querySelectorAll('.code-block').forEach(block => {
			const originalCode = block.textContent || block.innerText;

			if (!originalCode.trim()) return;

			try {
				// 코드 타입 자동 감지 및 포맷팅
				let formattedCode;

				// HTML 태그가 있으면 HTML로 처리
				if (originalCode.includes('<') && originalCode.includes('>')) {
					formattedCode = prettier.format(originalCode, {
						parser: 'html',
						plugins: prettierPlugins,
						tabWidth: 2,
						useTabs: false,
						htmlWhitespaceSensitivity: 'css',
						printWidth: 80
					});
				}
				// CSS 속성이 있으면 CSS로 처리
				else if (originalCode.includes('{') && originalCode.includes(':') && originalCode.includes(';')) {
					formattedCode = prettier.format(originalCode, {
						parser: 'css',
						plugins: prettierPlugins,
						tabWidth: 2,
						useTabs: false,
						printWidth: 80
					});
				}
				// JSON 형태면 JSON으로 처리
				else if ((originalCode.trim().startsWith('{') && originalCode.trim().endsWith('}')) ||
					(originalCode.trim().startsWith('[') && originalCode.trim().endsWith(']'))) {
					try {
						const parsed = JSON.parse(originalCode);
						formattedCode = JSON.stringify(parsed, null, 2);
					} catch (e) {
						// JSON 파싱 실패시 JavaScript로 처리
						formattedCode = prettier.format(originalCode, {
							parser: 'babel',
							plugins: prettierPlugins,
							semi: true,
							singleQuote: true,
							tabWidth: 2,
							useTabs: false,
							trailingComma: 'es5',
							printWidth: 80,
							bracketSpacing: true,
							arrowParens: 'avoid'
						});
					}
				}
				// 기본적으로 JavaScript로 처리
				else {
					formattedCode = prettier.format(originalCode, {
						parser: 'babel',
						plugins: prettierPlugins,
						semi: true,
						singleQuote: true,
						tabWidth: 2,
						useTabs: false,
						trailingComma: 'es5',
						printWidth: 80,
						bracketSpacing: true,
						arrowParens: 'avoid'
					});
				}

				// 포맷된 코드 적용
				block.textContent = formattedCode;

			} catch (error) {
				console.warn('코드 포맷팅 실패:', error);
				// 포맷팅 실패시 최소한의 기본 정리만 수행
				block.textContent = originalCode
					.split('\n')
					.map(line => line.trim())
					.filter(line => line.length > 0)
					.join('\n');
			}
		});
	}

	// 페이지 로드 후 자동 실행
	document.addEventListener('DOMContentLoaded', beautifyCodeBlocks);

	// 동적으로 코드가 추가될 때를 위한 함수
	function refreshCodeBlocks() {
		beautifyCodeBlocks();
	}
</script>

</html>